// Настройка Timer0 для ШИМ на пине D5 (OC0B) с частотой ~1200 Гц
void setup() {
  // Настройка пина D5 как выхода
  pinMode(5, OUTPUT);

  // Отключение прерываний на время настройки
  cli();

  // Сброс регистров Timer0
  TCCR0A = 0;
  TCCR0B = 0;

  // Настройка режима CTC (WGM02:0 = 010)
  TCCR0A |= (1 << WGM01); // CTC mode (WGM01 = 1, WGM00 = 0)
  TCCR0B &= ~(1 << WGM02); // WGM02 = 0

  // Установка предделителя 64 (CS02:0 = 011)
  TCCR0B |= (1 << CS01) | (1 << CS00); // Предделитель 64

  // Установка TOP для ~1200 Гц (OCR0A = 207)
  OCR0A = 207;

  // Включение ШИМ на OC0B (D5) в неинвертирующем режиме
  TCCR0A |= (1 << COM0B1); // COM0B1 = 1, COM0B0 = 0 (неинвертирующий ШИМ)

  // Установка начальной скважности (например, 50%)
  OCR0B = 104; // 50% duty cycle (207 / 2)

  // Включение прерываний
  sei();
}

void loop() {
  // Пример изменения скважности (0-255 масштабируется к 0-207)
  analogWrite(5, 128); // Установить ~50% скважности
  delay(1000);
  analogWrite(5, 64);  // Установить ~25% скважности
  delay(1000);
} 